---
title: Denoばた会議 Monthly 第24回
description: Denoばた会議 Monthly 第24回
keywords: Deno
url: https://uki00a.github.io/slides/denobata-2023-11-17
paginate: true
---

# Denoばた会議 Monthly 第24回

<!-- _class: lead -->

---

# [Deno v1.38](https://uki00a.github.io/deno-weekly/articles/deno/v1.38)

<!-- _class: lead -->

---

## BYONM (_Bring your own node_modules_)

npmやpnpmなどで作成された`node_modules`からパッケージを読み込むための機能です。

`deno.json`で以下を指定するか`--unstable-byonm`により有効化できます。

```json
{
  "unstable": ["byonm"]
}
```

---

## `deno doc --html`

APIドキュメントを静的なHTMLページとして出力できます。

```shell
$ deno doc --html --output=api-docs --name=fresh-testing-library mod.ts
Written 261 files to "./api-docs/"
```

---

## `deno doc --lint`

各APIのJSDocドキュメントに対して検査を行うことができます。

```shell
$ deno doc --lint server.ts
Type 'CreateHandlerContextOptions' references type 'ContextFactoryOptions'
  which is not exported from a root module.
    at file:///home/uki00a/ghq/github.com/uki00a/fresh-testing-library/server.ts:27:1

  ...

Missing JS documentation comment.
    at file:///home/uki00a/ghq/github.com/uki00a/fresh-testing-library/server.ts:294:1

error: Found 13 documentation diagnostics.

$ echo $?
1
```

---

## HMRがサポート (--unstable-hmr)

```shell
$ deno run --unstable-hmr=config.json --no-clear-screen mod.ts
```

```javascript
function handleHMR(path: string) {
  // ...
}

addEventListener("hmr", (e) => {
  handleHMR(e.detail.path);
});
```

---

## unstable APIの詳細な制御

`deno.json`に`"unstable"`フィールドが追加されています。

```javascript
{
  // Deno KVとDeno.cron関連のunstable APIのみを有効化します
  "unstable": ["kv", "cron"]
}
```

---

## unstable APIの詳細な制御 (2)

`--unstable-*`オプションによる有効化も可能です。

```shell
# Deno KVとFFI関連のunstable APIのみを有効化します
$ deno run --unstable-kv --unstable-ffi main.js
```

---

## `compilerOptions.jsx: "precompile"`

SSRでの利用を想定して最適化されたDeno独自のオプションです。

```json
{
  "compilerOptions": {
    "jsx": "precompile",
    "jsxImportSource": "preact"
  },
  "imports": {
    "preact": "https://esm.sh/preact@10.19.0",
    "preact/": "https://esm.sh/preact@10.19.0/"
  }
}
```

---

## `.env`のサポート (`--env`オプション)

`--allow-read=.env`なしで読み込めます。

```shell
$ deno run --env main.js
```

また、`.env`以外から読み込むこともできます。

```shell
$ deno run --env=.env.development main.js
```

---

## `Deno.cron()`

利用するには`deno.json`で`"unstable": ["cron"]`指定する または `--unstable-cron`の指定が必要です。

```javascript
Deno.cron(
  "sample", // ジョブ名
  "*/1 * * * *", // cron式
  async () => { // ハンドラー
    await doSomething();
  },
);
```
