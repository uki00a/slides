---
title: Denoã°ãŸä¼šè­° Monthly ç¬¬1å›
description: Denoã°ãŸä¼šè­° Monthly ç¬¬1å›
keywords: Deno
url: https://uki00a.github.io/slides/denobata-2021-09-19
---

# Denoã°ãŸä¼šè­° Monthly ç¬¬1å›

<!-- _class: lead -->

---

# Denoã®æœ€æ–°æƒ…å ±

<!-- _class: lead -->

---

# Deno 2.0ã®ã‚¹ã‚³ãƒ¼ãƒ—ã«ã¤ã„ã¦

<!-- _class: lead -->

---

## å†…å®¹

GitHub Discussionsã§Deno 2.0ã®ã‚¹ã‚³ãƒ¼ãƒ—ãŒå…¬é–‹ã•ã‚Œã¾ã—ãŸ (https://github.com/denoland/deno/discussions/11972)

ç¾æ™‚ç‚¹ã§ã¯ã€ä»Šå¹´ã®11æœˆã«2.0ã®ãƒªãƒªãƒ¼ã‚¹ãŒæ¤œè¨ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

---

## æ¤œè¨ä¸­ã®å¤‰æ›´å†…å®¹

ä»Šå¾Œã€å¤‰æ›´ã•ã‚Œã‚‹å¯èƒ½æ€§ã‚‚ã‚ã‚‹ã¿ãŸã„ãªã®ã§å‚è€ƒç¨‹åº¦ã«...

- [Deno.Readerãªã©ã®JSã®ã¿ã§å®Ÿè£…ã•ã‚ŒãŸIOé–¢é€£ã®APIã‚’å‰Šé™¤](https://github.com/denoland/deno/issues/9795) (ä¸€éƒ¨ã®APIã¯ã™ã§ã«std/ioã¸ç§»è¡Œæ¸ˆã¿)
- [ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å‹ãƒã‚§ãƒƒã‚¯ã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹](https://github.com/denoland/deno/issues/11340)
- [`--config`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®å‰Šé™¤](https://github.com/denoland/deno/discussions/7732)
- TypeScriptã®`useUnknownInCatchVariables`ã‚’æœ‰åŠ¹åŒ–
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒ­ãƒƒã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿæˆãƒ»æ¤œè¨¼ã‚’è¡Œã†
- `--allow-import`ã®å°å…¥

ãªã©

---

# Deno v1.13

<!-- _class: lead -->

---

## ãƒã‚¤ãƒ†ã‚£ãƒ–HTTPã‚µãƒ¼ãƒã®å®‰å®šåŒ–

`Deno.serveHttp`ã‚’ä½¿ç”¨ã™ã‚‹éš›ã«`--unstable`ãŒä¸è¦ã«ãªã‚Šã¾ã—ãŸã€‚

```ts
const listener = Deno.listen({ port: 3000 });
(async () => {
  for await (const conn of listener) {
    (async () => {
      const httpConn = Deno.serveHttp(conn);
      for await (const { request, respondWith } of httpConn) {
        const response = new Response("Hello world!");
        respondWith(response);
      }
    })();
  }
})();
```

---

## ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ ãŒå‰Šé™¤ã•ã‚Œã€ä»£ã‚ã‚Šã«FFIã‚’å°å…¥

```ts
const dylib = Deno.dlopen("./add.so", {
  add: {
    parameters: ["i32", "i32"],
    result: "i32",
  },
});
console.assert(dylib.symbols.add(1, 2) === 3);
```

---

## `deno test --doc`ã§MarkdownãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¾ã—ãŸ

~~~~~~markdown
  <!-- README.md -->
  ## Usage

  ```ts
  import { connect } from "https://deno.land/x/redis/mod.ts";
  
  const redis = await connect({ hostname: "127.0.0.1" });
  console.assert(await redis.ping() === "PONG");
  console.assert(await redis.quit() === "OK");
  ```
~~~~~~

```shell
$ deno test --doc --import-map=import_map.test.json README.md
```

https://uki00a.github.io/blog/articles/007-how-to-effectively-test-README-with-deno-test-doc/

---

## WebSocketStreamã®å®Ÿè£… (ã¾ã unstableã§ã™)

```ts
const stream = new WebSocketStream("ws://localhost:3000");
const { readable, writable } = await stream.connection;

const writer = writable.getWriter();
await writer.write("Hello world!");

setTimeout(() => stream.close(), 5000);

for await (const message of readable) {
  console.log(message);
}
```

---

## ãã®ä»–ã«ã‚‚æ§˜ã€…ãªæ©Ÿèƒ½ãŒè¿½åŠ ã•ã‚Œã¦ã„ã¾ã™

- `self.structuredClone`ã®ã‚µãƒãƒ¼ãƒˆ
- `Deno.writeFile`ã§`AbortSignal`ãŒã‚µãƒãƒ¼ãƒˆ
- `DENO_TLS_CA_STORE`
- `--unsafely-treat-insecure-origin-as-secure`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚µãƒãƒ¼ãƒˆ
- Web Crypto APIã®å®Ÿè£…ãŒé€²ã‚“ã  (`SubtleCrypto#importKey/exportKey`ã§ã®HMACã®ã‚µãƒãƒ¼ãƒˆãªã©)
- `deno lsp`ã§Refactoringã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚µãƒãƒ¼ãƒˆ
- V8 9.3ã¸ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ (`Object.hasOwn`ã®ã‚µãƒãƒ¼ãƒˆãªã©)

ã‚ˆã‚Šè©³ã—ãã¯[maguroã•ã‚“ã®è¨˜äº‹](https://zenn.dev/magurotuna/articles/deno-release-note-1-13-0)ã‚„[å…¬å¼ã®ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆ](https://deno.com/blog/v1.13)ã‚’å‚ç…§

---

# deno_std/cryptoãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

deno_std v0.104.0ã§è¿½åŠ ã•ã‚ŒãŸæ–°è¦ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

æ¨™æº–ã®Web Crypto APIã‚’æ‹¡å¼µã—ã€æ§˜ã€…ãªã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’æä¾›ã—ã¾ã™ã€‚

Denoæœ¬ä½“ã§Web Crypto APIã®å®Ÿè£…ãŒé€²ã‚“ã§ããŸãŸã‚ã€å…ƒã€…å­˜åœ¨ã—ãŸstd/hashã¯å°†æ¥çš„ã«ã“ã¡ã‚‰ã¸ç½®ãæ›ãˆã‚‰ã‚Œã‚‹äºˆå®šã®ã‚ˆã†ã§ã™ã€‚

https://github.com/denoland/deno_std/pull/1025

---

# deno_std/collectionsãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

deno_std v0.102.0ã§è¿½åŠ ã•ã‚ŒãŸæ–°è¦ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

Kotlinã®æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«å½±éŸ¿ã‚’å—ã‘ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

```ts
import { groupBy } from "https://deno.land/std@0.106.0/collections/group_by.ts";

const users = [{ name: "foo", group: "admin" }, { name: "bar", group: "normal" }];
const usersByGroup = groupBy(users, (it) => it.group);
console.log(usersByGroup["admin"]);
```

https://zenn.dev/kawarimidoll/articles/7d1fc9f0fb6538

---

# Deno Deploy beta2

- `Deno.readFile`, `Deno.listen`, åŠã³`Deno.serveHttp`ãªã©ã®APIãŒã‚µãƒãƒ¼ãƒˆ
- ã“ã®ãƒªãƒªãƒ¼ã‚¹ã«åˆã‚ã›ã¦[Oak](https://deno.land/x/oak@v9.0.0/mod.ts)ãªã©ã§ã‚‚Deno Deployã®ã‚µãƒãƒ¼ãƒˆãŒå¼·åŒ–ã•ã‚Œã¦ã„ã¾ã™

[https://deno.com/blog/deploy-beta2](https://deno.com/blog/deploy-beta2)

---

# MDNã«DenoãŒæ²è¼‰

<!-- _class: lead -->

MDNã®äº’æ›æ€§ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ¬„ã«DenoãŒæ²è¼‰ã•ã‚Œã¾ã—ãŸ

ä¾‹)

- https://developer.mozilla.org/ja/docs/Web/API/URL
- https://developer.mozilla.org/ja/docs/Web/API/TextDecoder

https://deno.com/blog/deno-on-mdn

---

# deno_graph

`deno info --json`ã¨åŒæ§˜ã®æ©Ÿèƒ½ã‚’æä¾›ã—ã¦ãã‚Œã‚‹Rustã‚¯ãƒ¬ãƒ¼ãƒˆ

JavaScriptã‹ã‚‰ã‚‚åˆ©ç”¨ã§ãã¾ã™ã€‚

```ts
import { createGraph } from "https://deno.land/x/deno_graph@0.4.0/mod.ts";
const graph = await createGraph("https://deno.land/x/deno_graph@0.4.0/mod.ts");
console.log(graph.toJSON().modules.map((x) => x.specifier));
```

https://github.com/denoland/deno_graph

---

# deno_docã§JavaScript APIãŒå…¬é–‹

```ts
import { doc } from "https://deno.land/x/deno_doc@v0.13.0/mod.ts";
const nodes = await doc("https://deno.land/x/deno_doc@v0.13.0/mod.ts");
console.log(nodes.map((x) => x.name));
```

https://github.com/denoland/deno_doc

---

# å…¬å¼ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ãŒç‹¬ç«‹ã—ãŸãƒªãƒã‚¸ãƒˆãƒªã¸ç§»è¡Œ

å…¬å¼ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ãŒ[denoland/deno](https://github.com/denoland/manual)ã‹ã‚‰[denoland/manual](https://github.com/denoland/manual)ã¸ç§»è¡Œ

ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã—ã‚„ã™ããªã‚Šãã†ğŸ™†

---

# ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®æœ€æ–°æƒ…å ±

<!-- _class: lead -->

---

# Aleph.js v0.3ãƒ™ãƒ¼ã‚¿ãŒå…¬é–‹

<!-- _class: lead -->

---

## Aleph.jsã¨ã¯

Next.jsã«å½±éŸ¿ã‚’å—ã‘ãŸãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯

ä½œè€…ã¯[esm.sh](https://github.com/alephjs/esm.sh)ãªã©ã‚‚é–‹ç™ºã—ã¦ã„ã‚‹[ijeæ°](https://github.com/ije)ã§ã™ã€‚

---

## æ³¨æ„ç‚¹

ã¾ã ãƒ™ãƒ¼ã‚¿ç‰ˆãªã®ã§ã€ã“ã“ã§ç´¹ä»‹ã—ãŸæ©Ÿèƒ½ã¯ã†ã¾ãå‹•ã‹ãªã„ã‚±ãƒ¼ã‚¹ã‚‚ç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ã‚‚ã‚ã‚‹ã¨æ€ã„ã¾ã™ğŸ™‡

---

## ãƒ“ãƒ«ãƒ‰åŸºç›¤ãŒswc+esbuildã¸ç§»è¡Œ

å…ƒã€…ã€Aleph.jsã§ã¯ãƒ“ãƒ«ãƒ‰åŸºç›¤ã¨ã—ã¦tscãŒä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚

v0.3ãƒ™ãƒ¼ã‚¿ã«ã¦ãƒ“ãƒ«ãƒ‰åŸºç›¤ãŒswc+esbuildã¸ç§»è¡Œã•ã‚Œã¾ã—ãŸã€‚

ãƒ“ãƒ«ãƒ‰ã®é«˜é€ŸåŒ–ãªã©ãŒæœŸå¾…ã•ã‚Œã¾ã™ã€‚

---

## ssrã‚ªãƒ—ã‚·ãƒ§ãƒ³

Next.jsã«ãŠã‘ã‚‹`getStaticProps` / `getStaticPaths`ç›¸å½“ã®æ©Ÿèƒ½

```ts
import React from 'react'
import type { SSROptions } from 'aleph/types'

export const ssr: SSROptions = {
  props: async router => ({ date: Date.now() }),
  paths: async () => [],
}

export default function Page(props) {
  return (
    <p>{props.date}</p>
  )
}
```

---

## æ–°ã—ã„ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ 

Aleph.jsã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚’æ‹¡å¼µã™ã‚‹ä»•çµ„ã¿

### ä¾‹) Windi CSSãƒ—ãƒ©ã‚°ã‚¤ãƒ³

```ts
// aleph.config.ts
import windicss from 'https://deno.land/x/aleph_plugin_windicss@v0.0.2/plugin.ts'
import type { Config } from 'aleph/types'

export default {
  plugins: [windicss]
} as Config
```

ã“ã‚Œã ã‘ã§Tailwind CSSäº’æ›ã®ã‚¯ãƒ©ã‚¹ãŒä½¿ç”¨ã§ãã¾ã™ï¼

---

## linkã‚¿ã‚°ã‚’ä½¿ç”¨ã—ãŸScoped CSSã®ã‚µãƒãƒ¼ãƒˆ (JSX Magic)

```ts
import React from 'react'

export default function App() {
  return (
    <>
      <link rel="stylesheet" href="../style/app.module.css" />
      <h1 className="$title">Hello world!</h1>
    </>
  )
}
```

---

## ãã®ä»–ã«ã‚‚æ§˜ã€…ãªæ”¹å–„ãªã©ãŒå®Ÿæ–½ã•ã‚Œã¦ã„ã¾ã™

- APIãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®ã‚µãƒãƒ¼ãƒˆ
- deno_std/httpã‹ã‚‰ãƒã‚¤ãƒ†ã‚£ãƒ–HTTPã‚µãƒ¼ãƒ(Deno.serveHttp)ã¸ã®ç§»è¡Œ
- Vercelã®Serverless Functionsã‚µãƒãƒ¼ãƒˆ ([https://github.com/alephjs/vercel-aleph](https://github.com/alephjs/vercel-aleph))
- devã‚µãƒ¼ãƒãªã©ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å‘ä¸Š

---

# [Ultra](https://github.com/exhibitionist-digital/ultra)

Deno+Reactãƒ™ãƒ¼ã‚¹ã®Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯

- `ReactDOM.renderToReadableStream`ãƒ™ãƒ¼ã‚¹ã®SSR
- Viteãªã©ã¨åŒæ§˜ã®ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰ã§ã®ã‚³ãƒ¼ãƒ‰å¤‰æ› ([SWC](https://swc.rs/)ã‚„[esbuild](https://github.com/evanw/esbuild)ãŒãƒ™ãƒ¼ã‚¹)
- [SWR](https://github.com/vercel/swr)å‘ã‘ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ—ãƒ­ãƒ‘ã‚¤ãƒ€ã‚’æä¾›

---

# ãã®ä»–

### [deno-sqlite v3.0.0ãŒãƒªãƒªãƒ¼ã‚¹](https://github.com/dyedgreen/deno-sqlite/releases/tag/v3.0.0)

DB#queryãªã©ã®ãƒ¡ã‚½ãƒƒãƒ‰ã§å‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒã‚µãƒãƒ¼ãƒˆã€Rowsã‚¿ã‚¤ãƒ—ã¸ã®ç ´å£Šçš„å¤‰æ›´ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å‘ä¸Šãªã©ãŒå®Ÿæ–½ã•ã‚Œã¦ã„ã¾ã™ã€‚

### [Oak v9ãŒãƒªãƒªãƒ¼ã‚¹](https://github.com/oakserver/oak/commit/dd8f4a1579b808345b52f76c2b270ed3d31d53bc)

Cookieé–¢é€£ã®APIãŒéåŒæœŸã«å¤‰æ›´ã€Deno Deployã®ã‚µãƒãƒ¼ãƒˆã®å¼·åŒ–ãªã©
