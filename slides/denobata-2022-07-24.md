---
title: Denoã°ãŸä¼šè­° Monthly ç¬¬11å›
description: Denoã°ãŸä¼šè­° Monthly ç¬¬11å›
keywords: Deno
url: https://uki00a.github.io/slides/denobata-2022-07-24
---

# Denoã°ãŸä¼šè­° Monthly ç¬¬11å›

<!-- _class: lead -->

---

## Deno v1.24

<!-- _class: lead -->

---

### `--check`ã‚ªãƒ—ã‚·ãƒ§ãƒ³æŒ‡å®šæ™‚ã®ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ã®æŒ™å‹•ã®å¤‰æ›´

||å‹ãƒã‚§ãƒƒã‚¯|ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«|
|:---:|:---:|:---:|
|`--check` (v1.23)|tsc|**tsc**|
|`--no-check` (v1.23)|-|swc|
|`--check` (v1.24)|tsc|**swc**|
|`--no-check` (v1.24)|-|swc|

ã¾ãŸã€tscã®å®Ÿè¡Œçµæœã‚’SQLiteã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹ä»•çµ„ã¿ã‚‚å°å…¥ã•ã‚Œã¦ãŠã‚Šã€å‹ãƒã‚§ãƒƒã‚¯ã®åŠ¹ç‡åŒ–ã‚‚å›³ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

---

### FFI(`Deno.dlopen`)ã®æ”¹å–„

- V8 Fast API Calls+JITã‚³ãƒ³ãƒ‘ã‚¤ãƒ«([tinycc](https://github.com/TinyCC/tinycc))ã«ã‚ˆã‚‹æœ€é©åŒ– (**æœ€å¤§ã§200å€ã®é«˜é€ŸåŒ–ã‚’å®Ÿç¾**)
- [Deno.UnsafeCallback](https://doc.deno.land/https://raw.githubusercontent.com/denoland/deno/v1.24.0/cli/dts/lib.deno.unstable.d.ts/~/Deno.UnsafeCallback)ãŒè¿½åŠ ã•ã‚Œã€é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã‚’å–ã‚Šæ‰±ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
- `Deno.UnsafePointer`ãŒå‰Šé™¤ã•ã‚Œã€ãƒã‚¤ãƒ³ã‚¿ã¯`bigint`ã§å–ã‚Šæ‰±ã‚ã‚Œã‚‹ã‚ˆã†ã«å¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚

---

### `Deno.Child.unref` & `Deno.Child.ref` 

```typescript
const child = await Deno.spawnChild("some_long_running_process", { args });
child.unref();
```

ã“ã‚Œã«ã‚ˆã‚Šã€å­ãƒ—ãƒ­ã‚»ã‚¹ãŒDenoã®åœæ­¢ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ãªããªã‚Šã¾ã™ã€‚(`Deno.unrefTimer`ã¨åŒæ§˜ã®æŒ™å‹•)

---

### `import.meta.resolve()`ã®ã‚µãƒãƒ¼ãƒˆ

```ts
const worker = new Worker(import.meta.resolve("./worker.js")); // => "file:///home/uki00a/dev/worker.js"
```

Import mapsã‚‚è§£é‡ˆã—ã¦ãã‚Œã¾ã™ã€‚

```json
{
  "imports": {
    "redis": "https://deno.land/x/redis@v0.26.0/mod.ts"
  }
}
```

```ts
import.meta.resolve("redis"); // => "https://deno.land/x/redis@v0.26.0/mod.ts"
```

---

### ["unhandledrejection"](https://developer.mozilla.org/ja/docs/Web/API/Window/unhandledrejection_event)ã‚¤ãƒ™ãƒ³ãƒˆã®ã‚µãƒãƒ¼ãƒˆ

```ts
addEventListener("unhandledrejection", (event) => {
  console.error(event.reason); // error: Uncaught (in promise) Error: foo
});

Promise.reject(new Error("foo"));
```

---

### ["beforeunload"](https://developer.mozilla.org/ja/docs/Web/API/Window/beforeunload_event)ã‚¤ãƒ™ãƒ³ãƒˆã®ã‚µãƒãƒ¼ãƒˆ

```ts
let called = false;
addEventListener("beforeunload", (event) => {
  if (!called) {
    called = true;
    event.preventDefault();
    setTimeout(() => console.log(3), 50);
  }
});

setTimeout(() => {
  console.log(1);
  setTimeout(() => console.log(2), 200);
}, 100);
```

---

### `deno.json(c)`ã§`deno test`ãŒã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã‚‹ã‚ˆã†ã«

```json
{
  "test": {
    "files": {
      "exclude": ["vendor"]
    }
  }
}
```

https://github.com/denoland/deno/blob/f0e01682cce638303e3b6997788667a0f71dff8d/cli/schemas/config-file.v1.json#L325-L349

---

### `deno test`ã§`--parallel`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚µãƒãƒ¼ãƒˆ

ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’ä¸¦åˆ—å®Ÿè¡Œã§ãã¾ã™ã€‚

```json
$ deno test --parallel
```

æ—¢å­˜ã®`--jobs`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯éæ¨å¥¨åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚

---

### ãã®ä»–ã®å¤‰æ›´ç‚¹

- (**ç ´å£Šçš„å¤‰æ›´**) `Deno.Child`ã¨`Deno.SpawnOutput`ã®å‹å®šç¾©ã«å¤‰æ›´ãŒåŠ ã‚ã£ã¦ã„ã¾ã™ã€‚
- `deno lsp`ã§`import-map-remap`ã‚³ãƒ¼ãƒ‰ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚µãƒãƒ¼ãƒˆ

---

## deno_stdã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ

<!-- _class: lead -->

---

### `semver`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è¿½åŠ 

```typescript
import * as semver from "https://deno.land/std@0.149.0/semver/mod.ts";

console.log(semver.valid("v1.2.3")); // => 1.2.3
console.log(semver.gt("2.0.0", "1.2.4")); // => true
console.log(semver.satisfies("1.4.2", ">=1.x")); // => true
```

[Deno ã§ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã‚’é›‘ã«ä½œã£ãŸã®ã§æ„Ÿæƒ³](https://zenn.dev/sosukesuzuki/articles/177c782f8110ba)ã®è¨˜äº‹ãŒãã£ã‹ã‘ã§å…¥ã£ãŸã‚ˆã†ã§ã™ğŸ™„

---

### `encoding/json/stream`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è¿½åŠ 

```typescript
import { JSONParseStream } from "https://deno.land/std@0.149.0/encoding/json/stream.ts";
import { readableStreamFromIterable } from "https://deno.land/std@0.149.0/streams/conversion.ts";

const readable = readableStreamFromIterable([
  `{"name": "foo"}`,
  `{"a": 1, "b": true}`,
]).pipeThrough(new JSONParseStream());

for await (const json of readable) {
  console.log(json);
  // Output:
  // { name: "foo" }
  // { a: 1, b: true }
}
```

---

## [Deno raises $21M](https://deno.com/blog/series-a)

DenoãŒ$21Mã‚’èª¿é”

- [Deno raises $21M](https://deno.com/blog/series-a)

ã“ã®è¨˜äº‹ã§ã¯ã€Denoã‚„Deno DeployãŒã©ã®ã‚ˆã†ãªèƒŒæ™¯ãƒ»ç›®çš„ã§é–‹ç™ºã•ã‚Œã¦ã„ã‚‹ã®ã‹ã«ã¤ã„ã¦ã‚‚è§£èª¬ã•ã‚Œã¦ã„ã¾ã™ã€‚

---

## Fresh v1.0.0ãŒãƒªãƒªãƒ¼ã‚¹

ã“ã‚Œã«åˆã‚ã›ã¦ã€Freshã®ãƒªãƒã‚¸ãƒˆãƒªãŒdenoland organizationé…ä¸‹ã«ç§»å‹•ã•ã‚Œã¦ã„ã¾ã™ã€‚

- [denoland/fresh](https://github.com/denoland/fresh)

ã¾ãŸã€å…¬å¼ã§Freshã®ç´¹ä»‹è¨˜äº‹ã‚‚å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚

- [Fresh 1.0](https://deno.com/blog/fresh-is-stable)

---

## Bunã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒå…¬é–‹

JavaScriptCoreãƒ™ãƒ¼ã‚¹ã®JavaScriptãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã§ã‚ã‚‹Bunã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒå…¬é–‹ã•ã‚Œã¾ã—ãŸã€‚

- https://github.com/oven-sh/bun

