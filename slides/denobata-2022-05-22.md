---
title: Denoã°ãŸä¼šè­° Monthly ç¬¬9å›
description: Denoã°ãŸä¼šè­° Monthly ç¬¬9å›
keywords: Deno
url: https://uki00a.github.io/slides/denobata-2022-05-22
---

# Denoã°ãŸä¼šè­° Monthly ç¬¬9å›

<!-- _class: lead -->

---


## Deno v1.22

<!-- _class: lead -->

---

### ãƒªãƒ¢ãƒ¼ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å‹ãƒã‚§ãƒƒã‚¯ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ç„¡åŠ¹åŒ–

`deno run`ã‚„`deno test`ãªã©ã®å„ã‚³ãƒãƒ³ãƒ‰ã§ãƒªãƒ¢ãƒ¼ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å‹ãƒã‚§ãƒƒã‚¯ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ç„¡åŠ¹åŒ–ã•ã‚Œã¾ã—ãŸã€‚

ã‚‚ã—ãƒªãƒ¢ãƒ¼ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å‹ãƒã‚§ãƒƒã‚¯ãŒå¿…è¦ãªéš›ã¯ã€`--check=all`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¾ãŸã¯`deno check --remote`ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã¾ãŸã€**æ¬¡ã®v1.23ã®ãƒªãƒªãƒ¼ã‚¹ã§`deno run`ã‚„`deno cache`ã‚³ãƒãƒ³ãƒ‰ã®å‹ãƒã‚§ãƒƒã‚¯ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ç„¡åŠ¹åŒ–ã•ã‚Œã‚‹äºˆå®šãªã®ã§æ³¨æ„ï¼**

---

**ç§»è¡Œã«ã¤ã„ã¦**

ä¾‹ãˆã°ã€CIã§`deno run`ã‚„`deno cache`ãªã©ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦å‹ãƒã‚§ãƒƒã‚¯ã‚’ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€ä»Šã®ã†ã¡ã«`deno check`ãªã©ã«ç§»è¡Œã—ã¦ãŠãã¨å®‰å…¨ã ã¨æ€ã„ã¾ã™ã€‚

```shell
# mod.tsã®å‹ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†
$ deno check mod.ts

# deno runå®Ÿè¡Œæ™‚ã«å‹ãƒã‚§ãƒƒã‚¯ã‚‚è¡Œã†
$ deno run --check main.ts
```

---

### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®è‡ªå‹•æ¢ç´¢ã®ç„¡åŠ¹åŒ–

`--no-config`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¾ã—ãŸã€‚

ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹ã¨ã€`deno.json(c)`ã®è‡ªå‹•çš„ãªæ¢ç´¢ã‚’ç„¡åŠ¹åŒ–ã§ãã¾ã™ã€‚

```bash
$ deno run --no-config main.ts
```

---

### (ç ´å£Šçš„å¤‰æ›´) `Worker`å†…ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§Deno APIãŒæœ‰åŠ¹åŒ–

```js
// v1.21 (denoã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã®æœ‰åŠ¹åŒ–ãŒå¿…è¦)
new Worker(new URL('./worker.js', import.meta.url).href, {
  deno: { namespace: true },
  type: "module",
});

// v1.22 (denoã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã®æœ‰åŠ¹åŒ–ã¯ä¸è¦)
new Worker(new URL('./worker.js', import.meta.url).href, { type: "module" });
```

---

### (ç ´å£Šçš„å¤‰æ›´) `Deno.emit()`ã®å‰Šé™¤

Denoå…¬å¼ã§[denoland/deno_emit](https://github.com/denoland/deno_emit/)ã¨ã„ã†ä»£æ›¿ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒå…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€`Deno.emit()`ã‚’ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€ãã¡ã‚‰ã¸ç§»è¡Œã§ãã¾ã™ã€‚

```js
import { bundle } from "https://deno.land/x/emit@0.0.2/mod.ts";

const { code } = await bundle("https://deno.land/std@0.140.0/examples/chat/server.ts");
await Deno.writeTextFile("bundle.js", code);
```

---

### ã‚µãƒ–ãƒ—ãƒ­ã‚»ã‚¹APIã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ

**`AbortSignal`ã®ã‚µãƒãƒ¼ãƒˆ**

```js
const controller = new AbortController();
const child = Deno.spawnChild(Deno.execPath(), {
  args: [
    "eval",
    "setTimeout(() => console.log('foobar'), 10000)",
  ],
  signal: controller.signal,
});
queueMicrotask(() => controller.abort());

const status = await child.status;
console.assert(!status.success);
```

---

**(ç ´å£Šçš„å¤‰æ›´) `ChildStatus.signal`ãŒæ•°å€¤ã‹ã‚‰æ–‡å­—åˆ—ã¸å¤‰æ›´**

```js
const child = Deno.spawnChild(Deno.execPath(), { args });

// ...

const status = await child.status;
status.signal; // => "SIGTERM" (v1.21ã¾ã§ã¯æ•°å€¤ãŒè¨­å®š)
```

---

## `Response.json()`ãŒã‚µãƒãƒ¼ãƒˆ

`application/json`å½¢å¼ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç°¡æ˜“çš„ã«ä½œæˆã§ãã¾ã™ã€‚

```js
const res = Response.json({ name: "foo" });

res.status; // => 200
res.headers.get("content-type"); // => "application/json"
await res.json(); // => { name: "foo" }
```

**ãƒ˜ãƒƒãƒ€ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º**

```js
Response.json({ id: 1 }, { headers: { "x-foo": "foo" } });
```

---

## ãã®ä»–ã®å¤‰æ›´

- `deno lsp`ã§ãƒªãƒ³ãƒˆãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœ‰åŠ¹åŒ–
- `deno test`ã§ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆã®å‡ºåŠ›ãŒæ”¹å–„ (Uncaught errorã®å‡ºåŠ›ãªã©)
- `Deno.resolveDns()`ã§NSã‚„SOAãƒ¬ã‚³ãƒ¼ãƒ‰ãªã©ã®å•ã„åˆã‚ã›ãŒã‚µãƒãƒ¼ãƒˆ
- `performance.timeOrigin`ã‚„`performance.toJSON`, `navigator.userAgent`ãªã©ã®APIãŒã‚µãƒãƒ¼ãƒˆ

---

## deno_stdã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ

<!-- _class: lead -->

---

### `encoding/jsonc` (v0.139.0)

JSONCãƒ‘ãƒ¼ã‚µãŒå®Ÿè£…ã•ã‚Œã¾ã—ãŸã€‚

```ts
import { parse } from "https://deno.land/std@0.139.0/encoding/jsonc.ts";

console.log(parse(`{
  // hello
  "foo": 1
}`)); // => { foo: 1 }
```

---

## Denoã®å‹•å‘

<!-- _class: lead -->

---

### `deno.json(c)`ã§ã®ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã®å®£è¨€

`deno.json(c)`ã§ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’å®£è¨€ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹PRãŒä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚

[[WIP] feat: support â€œpermissionsâ€ in config file (#14520)](https://github.com/denoland/deno/pull/14520)

```json
{
  "permissions": {
    "read": true,
    "env": ["PORT"]
  }
}
```

---

### WASMãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®import

Denoã§`.wasm`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’`import`ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹PRãŒä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚

[WIP: wasm modules in core (#14485)](https://github.com/denoland/deno/pull/14485)

```js
import { some_function } from "./some_module.wasm";
```

---

### SQLiteãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°

æ­£å¼ã«å…¥ã‚‹ã‹ã©ã†ã‹ã¯ã¾ã ã‚ã‹ã‚Šã¾ã›ã‚“ãŒã€Denoã§SQLiteã®ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚’å…¬é–‹ã™ã‚‹PRãŒä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚

[experiment(runtime): expose SQLite bindings (#14627)](https://github.com/denoland/deno/pull/14627)

```js
const { Connection } = Deno.sqlite;
const conn = new Connection("sqlite.db");
const stmt = conn.prepare(`SELECT * FROM users WHERE id = ?`);
stmt.query(123);
```

---

### `deno_std`ã¸ã®`deno-sqlite`ã®è¿½åŠ 

`deno_std`ã«[deno-sqlite](https://github.com/dyedgreen/deno-sqlite)ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¿½åŠ ã™ã‚‹PRãŒä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚

[[WIP] feat: Add sqlite database driver (#2230)](https://github.com/denoland/deno_std/pull/2230)

ã“ã¡ã‚‰ã‚‚æ­£å¼ã«å…¥ã‚‹ã‹ã©ã†ã‹ã¯ã¾ã ä¸æ˜ã§ã™ğŸ™„

---

## [Web-interoperable Runtimes Community Group (WinterCG)](https://wintercg.org/)

Denoã‚„Node.js, Cloudflare Workersãªã©ã®éãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§å‹•ä½œã™ã‚‹å„ç¨®JavaScriptãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®ç›¸äº’é‹ç”¨æ€§ã®å‘ä¸Šã‚’ç›®çš„ã¨ã—ãŸã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—

è­°è«–ã®å†…å®¹ã‚„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãªã©ã¯GitHubä¸Šã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚

- [fetch()](https://github.com/wintercg/fetch)
- [Web Crypto APIã¸ã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã®ã‚µãƒãƒ¼ãƒˆ](https://github.com/wintercg/proposal-webcrypto-streams)

---

## [denoland/deno_blog](https://github.com/denoland/deno_blog)

```js
import blog from "https://deno.land/x/blog@0.0.1/blog.tsx";

blog(import.meta.url, {
  title: "My first blog",
  author: "uki00a",
  header: "Hello world!",
  style: "body { padding: 8rem 0; background-color: #f0f0f0; }",
});

```

ã“ã‚Œã§Deno Deployã§å‹•ä½œã™ã‚‹ãƒ–ãƒ­ã‚°ãŒä½œã‚Œã‚‹ã‚ˆã†ã§ã™ã€‚

---

## RemixãŒDenoã‚’å…¬å¼ã§ã‚µãƒãƒ¼ãƒˆ

ä»Šã¾ã§ã¯Remixã§ã®Denoã‚µãƒãƒ¼ãƒˆã¯å®Ÿé¨“çš„ã¨ã„ã†ä½ç½®ã¥ã‘ã§ã—ãŸãŒã€[Remix v1.5.0](https://github.com/remix-run/remix/releases/tag/v1.5.0)ã§Denoã®å…¬å¼ã‚µãƒãƒ¼ãƒˆãŒç™ºè¡¨ã•ã‚Œã¾ã—ãŸã€‚

```shell
$ npx create-remix@latest --template deno
```

---

## Aleph.jsã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ

- [v1.0.0-alpha.42](https://github.com/alephjs/aleph.js/releases/tag/1.0.0-alpha.42)ã§Vue.jsã‚µãƒãƒ¼ãƒˆãŒå¼·åŒ– (ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚„`useData()`ãƒ•ãƒƒã‚¯ãªã©ãŒã‚µãƒãƒ¼ãƒˆ)
  - [examples/vue-app](https://github.com/alephjs/aleph.js/tree/1.0.0-alpha.49/examples/vue-app)
- [Yew](https://github.com/yewstack/yew)ã®ä½¿ç”¨ä¾‹ãŒè¿½åŠ 
  - [examples/yew-app](https://github.com/alephjs/aleph.js/tree/1.0.0-alpha.49/examples/yew-app)

---

## Deno NewsãŒå†é–‹

[#42: Deno News is back! Featuring v1.21, Netlify Edge Functions, and JavaScript Containers](https://deno.news/archive/42-deno-news-is-back-featuring-v121-netlify-edge)

ãƒ¡ãƒ¼ãƒ«ã‚„RSSãƒ•ã‚£ãƒ¼ãƒ‰ãªã©ã§è³¼èª­ã§ãã‚‹ã‚ˆã†ãªã®ã§ã€ã‚‚ã—èˆˆå‘³ãŒã‚ã‚Šã¾ã—ãŸã‚‰è³¼èª­ã—ã¦ãŠãã¨ã‚ˆã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚


